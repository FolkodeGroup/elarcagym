generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma/client"
}

datasource db {
  provider = "postgresql"
  // url se configura ahora en prisma.config.ts (Prisma 7+)
}

model Member {
  id              String   @id @default(uuid())
  firstName       String
  lastName        String
  dni             String   @unique
  email           String   @unique
  password        String?  // Opcional - solo para admins, no para socios regulares
  phone           String
  joinDate        DateTime @default(now())
  status          String
  photoUrl        String?
  phase           String?
  bioObjective    String?
  lastAttendance  DateTime?
  nutritionPlan   Json?    // Almacena NutritionData como JSON
  habitualSchedules HabitualSchedule[]
  biometrics      BiometricLog[]
  routines        Routine[]
  diets           Diet[]
  payments        PaymentLog[]
  sales           Sale[]        @relation("MemberSales")
  reservations    Reservation[] @relation("MemberReservations")
}

model HabitualSchedule {
  id        String   @id @default(uuid())
  day       String
  start     String
  end       String
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model BiometricLog {
  id         String   @id @default(uuid())
  date       DateTime
  weight     Float
  height     Float?
  bodyFat    Float?
  chest      Float?
  waist      Float?
  abdomen    Float?
  hips       Float?
  glutes     Float?
  rightThigh Float?
  leftThigh  Float?
  rightCalf  Float?
  leftCalf   Float?
  rightArm   Float?
  leftArm    Float?
  neck       Float?
  memberId   String
  member     Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model Routine {
  id        String   @id @default(uuid())
  name      String
  goal      String
  assignedBy String
  createdAt DateTime @default(now())
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  days      RoutineDay[]
}

model RoutineDay {
  id        String   @id @default(uuid())
  dayName   String
  routineId String
  routine   Routine  @relation(fields: [routineId], references: [id], onDelete: Cascade)
  exercises ExerciseDetail[]
}

model ExerciseDetail {
  id        String   @id @default(uuid())
  name      String
  series    String
  reps      String
  weight    String
  notes     String?
  routineDayId String
  routineDay   RoutineDay @relation(fields: [routineDayId], references: [id], onDelete: Cascade)
}

model Diet {
  id        String   @id @default(uuid())
  name      String
  calories  Int
  description String
  generatedAt DateTime @default(now())
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model PaymentLog {
  id        String   @id @default(uuid())
  date      DateTime
  amount    Float
  concept   String
  method    String
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model Product {
  id        String   @id @default(uuid())
  name      String
  price     Float
  category  String
  stock     Int
  sales     SaleItem[]
}

model Sale {
  id        String   @id @default(uuid())
  date      DateTime @default(now())
  total     Float
  memberId  String?
  member    Member?  @relation("MemberSales", fields: [memberId], references: [id])
  items     SaleItem[]
}

model SaleItem {
  id          String   @id @default(uuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  saleId      String
  sale        Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  quantity    Int
  priceAtSale Float
  productName String?
}

model Reminder {
  id        String   @id @default(uuid())
  text      String
  date      DateTime
  priority  String
}

model Slot {
  id        String   @id @default(uuid())
  date      DateTime
  time      String
  duration  Int
  status    String
  target    String?
  color     String?
  reservations Reservation[]
}

model Reservation {
  id          String   @id @default(uuid())
  slotId      String
  slot        Slot     @relation(fields: [slotId], references: [id], onDelete: Cascade)
  memberId    String?
  member      Member?  @relation("MemberReservations", fields: [memberId], references: [id])
  clientName  String
  clientPhone String?
  clientEmail String?
  notes       String?
  attended    Boolean?
  accessedAt  DateTime?
  createdAt   DateTime @default(now())
}

model ExerciseMaster {
  id        String   @id @default(uuid())
  name      String
  category  String
}
